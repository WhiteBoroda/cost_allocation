<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Cost Breakdown Wizard Form -->
    <record id="view_service_cost_breakdown_wizard" model="ir.ui.view">
        <field name="name">service.cost.breakdown.wizard.form</field>
        <field name="model">service.cost.breakdown.wizard</field>
        <field name="arch" type="xml">
            <form string="Service Cost Breakdown Analysis">
                <header>
                    <button name="action_create_missing_cost_records"
                            string="Create Missing Cost Records"
                            type="object"
                            class="btn-secondary"
                            icon="fa-plus"/>
                </header>

                <sheet>
                    <div class="alert alert-info" role="status">
                        <h3><i class="fa fa-calculator"/> ABC Costing Breakdown</h3>
                        <p>This analysis shows how the <strong>base cost</strong> is calculated from employee expenses using Activity-Based Costing methodology.</p>
                    </div>

                    <group string="Service Information">
                        <group>
                            <field name="service_name"/>
                            <field name="service_code"/>
                            <field name="support_hours_per_unit"
                                   decoration-warning="support_hours_per_unit == 0"/>
                        </group>
                        <group>
                            <field name="team_count"/>
                            <field name="average_hourly_cost" widget="monetary"
                                   decoration-danger="average_hourly_cost == 0"/>
                            <field name="currency_id" groups="base.group_multi_currency"/>
                        </group>
                    </group>

                    <group string="Cost Calculation">
                        <div class="alert alert-success">
                            <h5>Formula: Base Cost = Average Hourly Cost × Support Hours per Unit</h5>
                            <p><strong><field name="average_hourly_cost" widget="monetary"/> × <field name="support_hours_per_unit"/> hours = <field name="base_cost" widget="monetary"/></strong></p>
                        </div>
                        <group>
                            <field name="base_cost" widget="monetary" readonly="1"
                                   decoration-danger="base_cost == 0"
                                   decoration-success="base_cost > 0"/>
                            <field name="markup_percentage"/>
                            <field name="sales_price" widget="monetary" readonly="1"
                                   class="oe_subtotal_footer_separator"/>
                        </group>
                    </group>

                    <group string="Responsible Team Cost Details">
                        <field name="employee_cost_line_ids" nolabel="1">
                            <tree string="Employee Costs"
                                  decoration-danger="not has_cost_record"
                                  decoration-success="has_cost_record and hourly_cost > 0">
                                <field name="employee_id"/>
                                <field name="monthly_cost" widget="monetary" sum="Total Monthly"/>
                                <field name="hourly_cost" sum="Total Hourly"/>
                                <field name="cost_per_service_unit" widget="monetary"
                                       sum="Total per Unit"/>
                                <field name="has_cost_record" widget="boolean_toggle"
                                       string="Has Cost Record"/>
                                <field name="currency_id" column_invisible="1"/>
                            </tree>
                        </field>
                    </group>

                    <div class="alert alert-warning" invisible="not has_missing_records">
                        <h5><i class="fa fa-exclamation-triangle"/> Missing Cost Records</h5>
                        <p>Some team members don't have cost records. Click <strong>"Create Missing Cost Records"</strong> to create them with default values, then update with actual salary data.</p>
                        <field name="has_missing_records" invisible="1"/>
                    </div>

                    <group string="Cost Analysis Summary">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="alert alert-info">
                                    <h6><i class="fa fa-users"/> Team Information</h6>
                                    <ul>
                                        <li><strong>Team Size:</strong> <field name="team_count"/> employees</li>
                                        <li><strong>Average Hourly Cost:</strong> <field name="average_hourly_cost" widget="monetary"/></li>
                                        <li><strong>Service Hours Required:</strong> <field name="support_hours_per_unit"/> hours</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="alert alert-success">
                                    <h6><i class="fa fa-money"/> Pricing Structure</h6>
                                    <ul>
                                        <li><strong>Base Cost (ABC):</strong> <field name="base_cost" widget="monetary"/></li>
                                        <li><strong>Markup:</strong> <field name="markup_percentage"/>%</li>
                                        <li><strong>Sales Price:</strong> <field name="sales_price" widget="monetary"/></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Action for Cost Breakdown Wizard -->
    <record id="action_service_cost_breakdown_wizard" model="ir.actions.act_window">
        <field name="name">Service Cost Breakdown</field>
        <field name="res_model">service.cost.breakdown.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>
</odoo>