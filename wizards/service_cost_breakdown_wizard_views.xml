<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Cost Breakdown Wizard Form -->
    <record id="view_service_cost_breakdown_wizard" model="ir.ui.view">
        <field name="name">service.cost.breakdown.wizard.form</field>
        <field name="model">service.cost.breakdown.wizard</field>
        <field name="arch" type="xml">
            <form string="Service Cost Breakdown Analysis">
                <header>
                    <button name="action_create_missing_cost_records"
                            string="Create Missing Cost Records"
                            type="object"
                            class="btn-secondary"
                            icon="fa-plus"/>
                </header>

                <sheet>
                    <div class="oe_title">
                        <h1>Cost Breakdown Analysis</h1>
                        <h2><field name="service_name" readonly="1"/></h2>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <group string="Service Information">
                                <field name="service_code"/>
                                <field name="support_hours_per_unit"/>
                                <field name="team_count"/>
                                <field name="currency_id" groups="base.group_multi_currency"/>
                            </group>
                        </div>
                        <div class="col-md-6">
                            <group string="Cost Results">
                                <field name="average_hourly_cost" widget="monetary"/>
                                <field name="base_cost" widget="monetary" class="oe_subtotal_footer_separator"/>
                                <field name="markup_percentage"/>
                                <field name="sales_price" widget="monetary" class="oe_subtotal_footer_separator"/>
                            </group>
                        </div>
                    </div>

                    <div class="alert alert-success mt-3" role="status">
                        <h4>ABC Costing Formula</h4>
                        <p><strong>Base Cost = Average Team Hourly Cost √ó Support Hours per Unit</strong></p>
                        <p class="mb-0">
                            <field name="average_hourly_cost" widget="monetary"/> √ó
                            <field name="support_hours_per_unit"/> hours =
                            <strong><field name="base_cost" widget="monetary"/></strong>
                        </p>
                    </div>

                    <div class="alert alert-warning" invisible="not has_missing_records">
                        <h5>‚ö†Ô∏è Missing Employee Cost Records</h5>
                        <p>Some team members don't have cost records. Click "Create Missing Cost Records" to fix this.</p>
                        <field name="has_missing_records" invisible="1"/>
                    </div>

                    <separator string="Team Cost Breakdown"/>

                    <field name="employee_cost_line_ids" nolabel="1">
                        <tree string="Team Members"
                              decoration-danger="not has_cost_record"
                              decoration-success="has_cost_record and hourly_cost > 0"
                              decoration-warning="has_cost_record and hourly_cost == 0">
                            <field name="employee_id" string="Employee"/>
                            <field name="monthly_cost" widget="monetary" string="Monthly Cost"/>
                            <field name="hourly_cost" string="Hourly Rate"/>
                            <field name="cost_per_service_unit" widget="monetary" string="Cost per Service Unit"/>
                            <field name="has_cost_record" widget="boolean_toggle" string="Has Cost Record"/>
                            <field name="currency_id" column_invisible="1"/>
                        </tree>
                    </field>

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="alert alert-info">
                                <h6>üìä Team Analysis</h6>
                                <table class="table table-sm">
                                    <tr>
                                        <td><strong>Team Size:</strong></td>
                                        <td><field name="team_count"/> employees</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Avg Hourly Cost:</strong></td>
                                        <td><field name="average_hourly_cost" widget="monetary"/></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Service Hours:</strong></td>
                                        <td><field name="support_hours_per_unit"/> hours</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="alert alert-primary">
                                <h6>üí∞ Pricing Structure</h6>
                                <table class="table table-sm">
                                    <tr>
                                        <td><strong>Base Cost (ABC):</strong></td>
                                        <td><field name="base_cost" widget="monetary"/></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Markup:</strong></td>
                                        <td><field name="markup_percentage"/>%</td>
                                    </tr>
                                    <tr class="table-active">
                                        <td><strong>Sales Price:</strong></td>
                                        <td><strong><field name="sales_price" widget="monetary"/></strong></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Action for Cost Breakdown Wizard -->
    <record id="action_service_cost_breakdown_wizard" model="ir.actions.act_window">
        <field name="name">Service Cost Breakdown</field>
        <field name="res_model">service.cost.breakdown.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{'dialog_size': 'extra-large'}</field>
    </record>
</odoo>